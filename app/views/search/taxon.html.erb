<% isa = "OBO_REL:is_a" %>
<h2>taxon: <%= taxon_name(@term_info) %></h2>
<div id="sidebar">
	<div id="term_info">
		<h4 class="term-info-header">Properties</h4>
		<div>
			<span class="term-info-field-label">ID:</span> <span><%= @term_info["id"] %></span>
		</div>
		<div>
			<span class="term-info-field-label">Ontology:</span> <span><%= ontology(@term_info) %></span>
		</div>
		<% rank = taxon_rank(@term_info) %>
		<% if rank %>
		<div>
			<span class="term-info-field-label">Rank:</span> <span><%= textOrNone(rank["name"]) %></span>
		</div>
		<% end %>
		<div>
			<span class="term-info-field-label">Synonyms:</span> <span>
				<% names = @term_info["synonyms"].collect {|item| item["name"]} %>
				<% if italicize_taxon?(@term_info) %>
					<% names = names.collect {|item| "<i>" + item + "</i>"} %>
				<% end %>
				<%= textOrNone(names.sort.join(", ")) %>
			</span>
		</div>
		<div>
			<% isa_parents = @term_info["parents"].find_all {|item| item["relation"]["id"] == isa} %>
			<span class="term-info-field-label">Parent:</span> <span><%= textOrNone(((isa_parents.sort_by {|item| item["target"]["name"]}).collect {|item| taxon_link(item["target"]) }).join(", ")) %></span>
		</div>
		<div>
			<% isa_children = @term_info["children"].find_all {|item| item["relation"]["id"] == isa} %>
			<span class="term-info-field-label">Children:</span> <span><%= textOrNone(((isa_children.sort_by {|item| item["target"]["name"]}).collect {|item| taxon_link(item["target"]) }).join(", ")) %></span>
		</div>
		<h4 class="term-info-header">More information</h4>
		<div>
			<a href="<%= bioportal_tto_url(@term_info) %>" target="_blank">View at NCBO Bioportal</a>
		</div>
	</div>
</div>
<div id="main">
	<% if @summary["characters"].empty? %>

	<p>No phenotypes were found involving <span class="term-name" title="<%=h @term_info["id"] %>"><%=h @term_info["name"] %></span>.</p>

	<% else %>

	<h3>Phenotypes</h3>
	<table class="annotations sortable" id="datatable">
		<tr>
			<th id="click-me">Entity</th><th>Quality</th><th>Zebrafish Genes</th><th>Taxa within <%= taxon_name(@term_info) %></th>
		</tr>
		<% for character in @summary["characters"] %>
		<tr>
			<td><%= entity_link(character["entity"]) %></td>
			<td><%= quality_link(character["character_quality"]) %> 
				<% filtered_examples = filter_out_attribute(character["character_quality"], character["qualities"]["examples"]) %>
				<% character["qualities"]["count"] -= 1 if filtered_examples.length < character["qualities"]["examples"].length %>
				<% formatted_list = list_more((filtered_examples.collect {|item| item["name"]}).sort!, character["qualities"]["count"]) %>
				<% if formatted_list %>
				<span class="example-values">: <%= formatted_list %></span>
				<% end %>
			</td>
			<td>
				<% if character["genes"]["count"] > 0 %>
					<a href="/phenotype/devo/<%=h character["entity"]["id"]%>/<%=h character["character_quality"]["id"]%>/"><%=h character["genes"]["count"] %></a>
				<% else %>
					0
				<% end %>
			</td>
			<td>
				<% if character["taxa"]["count"] > 0 %>
					<a href="/phenotype/evo/<%=h @term %>/<%=h character["entity"]["id"]%>/<%=h character["character_quality"]["id"]%>/"> <%=h character["taxa"]["count"] %></a>
				<% else %>
					0
				<% end %>
			</td>
		</tr>
		<% end %>
	</table>

	<% end %>
</div>
