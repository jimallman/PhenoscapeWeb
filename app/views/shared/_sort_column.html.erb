<% 
  sorted = (params[:filter] && !params[:filter][:sortby].blank? && params[:filter][:sortby] == sort_by)
  filter = params[:filter].clone
  filter[:sortby] = sort_by
  filter[:desc] = sorted && filter[:desc] == 'false' ? 'true' : 'false'
  link_text = "#{link_text}"
  link_text += " &nbsp;" + image_tag((params[:filter][:desc]=='true' ? 'down.png' : 'up.png'), :alt => "Sorted by link_text") if sorted
%>
<th class="sort_column <%= 'sorted' if sorted %> <%= css_classes.join(" ") if defined?(css_classes) && css_classes %>">
  <%= link_to link_text, :controller => controller, :action => action, :filter => filter %>
</th>